{% extends "base.html" %}

{% block title %}Configuration - Greenplum Cluster Deployment{% endblock %}

{% block content %}
<div class="tab-pane active">
    <h2><i class="fas fa-cog"></i> Configuration Settings</h2>
    <p>Configure your Greenplum cluster parameters</p>
    
    <form id="configForm" method="POST" action="/save_config">
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="coordinator_hostname">Coordinator Hostname</label>
                    <input type="text" id="coordinator_hostname" name="coordinator_hostname" 
                           value="{{ config.coordinator_hostname|default('') }}" required>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="coordinator_ip">Coordinator IP</label>
                    <input type="text" id="coordinator_ip" name="coordinator_ip" 
                           value="{{ config.coordinator_ip|default('') }}" required>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="installation_path">Installation Path</label>
                    <input type="text" id="installation_path" name="installation_path" 
                           value="{{ config.installation_path|default('/usr/local/greenplum-db') }}" required>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="data_directory">Data Directory</label>
                    <input type="text" id="data_directory" name="data_directory" 
                           value="{{ config.data_directory|default('/data/master') }}" required>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="segment_prefix">Segment Prefix</label>
                    <input type="text" id="segment_prefix" name="segment_prefix" 
                           value="{{ config.segment_prefix|default('sdw') }}" required>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="port_base">Port Base</label>
                    <input type="number" id="port_base" name="port_base" 
                           value="{{ config.port_base|default(6000) }}" required>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="mirror_port_base">Mirror Port Base</label>
                    <input type="number" id="mirror_port_base" name="mirror_port_base" 
                           value="{{ config.mirror_port_base|default(7000) }}" required>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="replication_port_base">Replication Port Base</label>
                    <input type="number" id="replication_port_base" name="replication_port_base" 
                           value="{{ config.replication_port_base|default(8000) }}" required>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="mirror_replication_port_base">Mirror Replication Port Base</label>
                    <input type="number" id="mirror_replication_port_base" name="mirror_replication_port_base" 
                           value="{{ config.mirror_replication_port_base|default(9000) }}" required>
                </div>\            </div>
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="database_name">Database Name</label>
                    <input type="text" id="database_name" name="database_name" 
                           value="{{ config.database_name|default('gpadmin') }}" required>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="database_port">Database Port</label>
                    <input type="number" id="database_port" name="database_port" 
                           value="{{ config.database_port|default(5432) }}" required>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="max_connections">Max Connections</label>
                    <input type="number" id="max_connections" name="max_connections" 
                           value="{{ config.max_connections|default(250) }}" required>
                </div>
            </div>
        </div>

        <h3>Cluster Initialization Parameters</h3>
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="encoding">Encoding</label>
                    <select id="encoding" name="encoding" required>
                        <option value="UTF8" {% if config.encoding == 'UTF8' %}selected{% endif %}>UTF8</option>
                        <option value="GBK" {% if config.encoding == 'GBK' %}selected{% endif %}>GBK</option>
                        <option value="LATIN1" {% if config.encoding == 'LATIN1' %}selected{% endif %}>LATIN1</option>
                    </select>
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label class="required" for="locale">Locale</label>
                    <input type="text" id="locale" name="locale" 
                           value="{{ config.locale|default('en_US.UTF-8') }}" required>
                </div>
            </div>
        </div>

        <h3>Optional Parameters</h3>
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="shared_buffers">Shared Buffers (MB)</label>
                    <input type="number" id="shared_buffers" name="shared_buffers" 
                           value="{{ config.shared_buffers|default(128) }}">
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="max_prepared_transactions">Max Prepared Transactions</label>
                    <input type="number" id="max_prepared_transactions" name="max_prepared_transactions" 
                           value="{{ config.max_prepared_transactions|default(250) }}">
                </div>
            </div>
        </div>

        <div class="form-group">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Configuration
            </button>
        </div>
    </form>
</div>
{% endblock %}